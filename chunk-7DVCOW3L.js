import{h as R,j as T,q as P}from"./chunk-HWATAB7I.js";import{c as b,e as I,f as D,l as _}from"./chunk-VORTGHKP.js";import"./chunk-YRE2X32C.js";import{R as p,Ua as S,Va as f,Wa as s,Xa as l,Ya as d,Za as y,ca as c,cb as v,eb as x,p as m,qa as n,ub as E,w as u,ya as g}from"./chunk-YSAVDWCI.js";var k=(r,t)=>["/",r,t],q=(r,t)=>t.id;function F(r,t){if(r&1&&(l(0,"li",2)(1,"a",3),y(2,"pd-highlighted-text",4)(3,"pd-highlighted-text",5)(4,"pd-highlighted-text",6),d()()),r&2){let e=t.$implicit,a=x();n(),s("routerLink",E(4,k,a.promptUrl,e.originalItem.slug)),n(),s("textData",e.titulo),n(),s("textData",e.prompt),n(),s("textData",e.descripcion)}}var C=class r{longitud=50;route=p(b);router=p(I);persistService=p(_);emptySearch=[];currentSearchTerm=c("");promptUrl="prompt";allSearchResults=c([]);initSearch=c("");ngOnInit(){this.route.queryParams.pipe(u(t=>t.search),m(t=>t.search)).subscribe(t=>{this.initSearch.set(t)})}onSearch(t){if(this.router.navigate([],{relativeTo:this.route,queryParams:{search:t.trim()},queryParamsHandling:"merge"}),t.length===0){this.allSearchResults.set(this.emptySearch),this.currentSearchTerm.set("");return}this.currentSearchTerm.set(t),this.persistService.search(t).subscribe(e=>{if(e.found.length===0){this.allSearchResults.set([]);return}let a=e.found.map(i=>{let o={id:i.item.id,titulo:{parts:[],in:-1},prompt:{parts:[],in:-1},descripcion:{parts:[],in:-1},autor:{parts:[],in:-1},matchType:i.relevanceScore===1?"exact":"fuzzy",matchScore:i.relevanceScore,originalItem:i.item};if(t.length>0&&i.foundIn!=="tags"&&i.foundIn!=="categoria"){let h=P(i.item[i.foundIn],t,this.longitud);o[i.foundIn]={parts:h.parts,in:h.highlightIndex}}return this.fillEmptyFields(o,i.item),o});this.allSearchResults.set(a)})}fillEmptyFields(t,e){t.titulo.parts.length===0&&(t.titulo={parts:[e.titulo.slice(0,this.longitud)],in:-1}),t.prompt.parts.length===0&&(t.prompt={parts:[e.prompt.slice(0,this.longitud)],in:-1}),t.descripcion.parts.length===0&&(t.descripcion={parts:[`${e.descripcion.slice(0,this.longitud)}...`],in:-1})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=g({type:r,selectors:[["pd-searching"]],decls:4,vars:1,consts:[["pd-search-header","",3,"search","term"],[1,"divide-y-[0.5px]","divide-gray-500/50","px-6","py-4"],[1,"overflow-x-hidden","py-2","w-full","group"],[1,"opacity-90","group-hover:opacity-100","transition-opacity",3,"routerLink"],[1,"text-primary-dark","font-titulo","text-sm/5",3,"textData"],[1,"font-merri","italic",3,"textData"],[1,"text-sm/5",3,"textData"]],template:function(e,a){e&1&&(l(0,"header",0),v("search",function(o){return a.onSearch(o)}),d(),l(1,"ul",1),S(2,F,5,7,"li",2,q),d()),e&2&&(s("term",a.initSearch()),n(2),f(a.allSearchResults()))},dependencies:[R,T,D],encapsulation:2})};export{C as Searching};
