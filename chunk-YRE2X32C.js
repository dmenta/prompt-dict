import{$b as v,Bc as ce,Gc as ue,Ha as V,Hc as le,I as L,Ic as b,Jc as de,N as x,Nc as fe,P as $,R as T,S as M,Wb as B,Xb as G,Y as j,Yb as H,Zb as J,_b as q,a as _,ac as W,bc as X,cc as Y,dc as z,ea as y,ec as K,fc as w,hc as Z,ic as Q,jc as ee,k as U,kc as te,l as N,lc as ne,mc as re,nc as oe,p as P,qc as ie,sc as se,tc as ae}from"./chunk-YSAVDWCI.js";var ve="type.googleapis.com/google.protobuf.Int64Value",be="type.googleapis.com/google.protobuf.UInt64Value";function ge(e,t){let n={};for(let r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function k(e){if(e==null)return null;if(e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&isFinite(e)||e===!0||e===!1||Object.prototype.toString.call(e)==="[object String]")return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>k(t));if(typeof e=="function"||typeof e=="object")return ge(e,t=>k(t));throw new Error("Data cannot be encoded in JSON: "+e)}function A(e){if(e==null)return e;if(e["@type"])switch(e["@type"]){case ve:case be:{let t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>A(t)):typeof e=="function"||typeof e=="object"?ge(e,t=>A(t)):e}var D="functions";var pe={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},d=class e extends q{constructor(t,n,r){super(`${D}/${t}`,n||""),this.details=r,Object.setPrototypeOf(this,e.prototype)}};function ke(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function I(e,t){let n=ke(e),r=n,o;try{let s=t&&t.error;if(s){let a=s.status;if(typeof a=="string"){if(!pe[a])return new d("internal","internal");n=pe[a],r=a}let i=s.message;typeof i=="string"&&(r=i),o=s.details,o!==void 0&&(o=A(o))}}catch{}return n==="ok"?null:new d(n,r,o)}var C=class{constructor(t,n,r,o){this.app=t,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,z(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.auth=n.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||n.get().then(s=>this.auth=s,()=>{}),this.messaging||r.get().then(s=>this.messaging=s,()=>{}),this.appCheck||o?.get().then(s=>this.appCheck=s,()=>{})}async getAuthToken(){if(this.auth)try{let t=await this.auth.getToken();return t?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){let n=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return n.error?null:n.token}return null}async getContext(t){let n=await this.getAuthToken(),r=await this.getMessagingToken(),o=await this.getAppCheckToken(t);return{authToken:n,messagingToken:r,appCheckToken:o}}};var O="us-central1",Ie=/^data: (.*?)(?:\n|$)/;function Ce(e){let t=null;return{promise:new Promise((n,r)=>{t=setTimeout(()=>{r(new d("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}var S=class{constructor(t,n,r,o,s=O,a=(...i)=>fetch(...i)){this.app=t,this.fetchImpl=a,this.emulatorOrigin=null,this.contextProvider=new C(t,n,r,o),this.cancelAllRequests=new Promise(i=>{this.deleteService=()=>Promise.resolve(i())});try{let i=new URL(s);this.customDomain=i.origin+(i.pathname==="/"?"":i.pathname),this.region=O}catch{this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(t){let n=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${n}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${n}.cloudfunctions.net/${t}`}};function Oe(e,t,n){let r=G(t);e.emulatorOrigin=`http${r?"s":""}://${t}:${n}`,r&&(H(e.emulatorOrigin),J("Functions",!0))}function Se(e,t,n){let r=o=>Fe(e,t,o,n||{});return r.stream=(o,s)=>_e(e,t,o,s),r}async function De(e,t,n,r){n["Content-Type"]="application/json";let o;try{o=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch{return{status:0,json:null}}let s=null;try{s=await o.json()}catch{}return{status:o.status,json:s}}async function Ae(e,t){let n={},r=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return r.authToken&&(n.Authorization="Bearer "+r.authToken),r.messagingToken&&(n["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(n["X-Firebase-AppCheck"]=r.appCheckToken),n}function Fe(e,t,n,r){let o=e._url(t);return Re(e,o,n,r)}async function Re(e,t,n,r){n=k(n);let o={data:n},s=await Ae(e,r),a=r.timeout||7e4,i=Ce(a),l=await Promise.race([De(t,o,s,e.fetchImpl),i.promise,e.cancelAllRequests]);if(i.cancel(),!l)throw new d("cancelled","Firebase Functions instance was deleted.");let u=I(l.status,l.json);if(u)throw u;if(!l.json)throw new d("internal","Response is not valid JSON object.");let c=l.json.data;if(typeof c>"u"&&(c=l.json.result),typeof c>"u")throw new d("internal","Response is missing data field.");return{data:A(c)}}function _e(e,t,n,r){let o=e._url(t);return Ue(e,o,n,r||{})}async function Ue(e,t,n,r){var o;n=k(n);let s={data:n},a=await Ae(e,r);a["Content-Type"]="application/json",a.Accept="text/event-stream";let i;try{i=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(s),headers:a,signal:r?.signal})}catch(f){if(f instanceof Error&&f.name==="AbortError"){let E=new d("cancelled","Request was cancelled.");return{data:Promise.reject(E),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(E)}}}}}}let g=I(0,null);return{data:Promise.reject(g),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(g)}}}}}}let l,u,c=new Promise((f,g)=>{l=f,u=g});(o=r?.signal)===null||o===void 0||o.addEventListener("abort",()=>{let f=new d("cancelled","Request was cancelled.");u(f)});let p=i.body.getReader(),m=Pe(p,l,u,r?.signal);return{stream:{[Symbol.asyncIterator](){let f=m.getReader();return{async next(){let{value:g,done:E}=await f.read();return{value:g,done:E}},async return(){return await f.cancel(),{done:!0,value:void 0}}}}},data:c}}function Pe(e,t,n,r){let o=(a,i)=>{let l=a.match(Ie);if(!l)return;let u=l[1];try{let c=JSON.parse(u);if("result"in c){t(A(c.result));return}if("message"in c){i.enqueue(A(c.message));return}if("error"in c){let p=I(0,c);i.error(p),n(p);return}}catch(c){if(c instanceof d){i.error(c),n(c);return}}},s=new TextDecoder;return new ReadableStream({start(a){let i="";return l();async function l(){if(r?.aborted){let u=new d("cancelled","Request was cancelled");return a.error(u),n(u),Promise.resolve()}try{let{value:u,done:c}=await e.read();if(c){i.trim()&&o(i.trim(),a),a.close();return}if(r?.aborted){let m=new d("cancelled","Request was cancelled");a.error(m),n(m),await e.cancel();return}i+=s.decode(u,{stream:!0});let p=i.split(`
`);i=p.pop()||"";for(let m of p)m.trim()&&o(m.trim(),a);return l()}catch(u){let c=u instanceof d?u:I(0,null);a.error(c),n(c)}}},cancel(){return e.cancel()}})}var me="@firebase/functions",he="0.12.9";var Le="auth-internal",xe="app-check-internal",$e="messaging-internal";function Me(e){let t=(n,{instanceIdentifier:r})=>{let o=n.getProvider("app").getImmediate(),s=n.getProvider(Le),a=n.getProvider($e),i=n.getProvider(xe);return new S(o,s,a,i,r)};X(new W(D,t,"PUBLIC").setMultipleInstances(!0)),w(me,he,e),w(me,he,"esm2017")}function je(e=K(),t=O){let r=Y(v(e),D).getImmediate({identifier:t}),o=B("functions");return o&&ye(r,...o),r}function ye(e,t,n){Oe(v(e),t,n)}function we(e,t,n){return Se(v(e),t,n)}Me();var h=class{constructor(t){return t}},Ee="functions",F=class{constructor(){return ee(Ee)}};var R=new $("angularfire2.functions-instances");function Ve(e,t){let n=Q(Ee,e,t);return n&&new h(n)}function Be(e){return(t,n)=>{let r=t.runOutsideAngular(()=>e(n));return new h(r)}}var Ge={provide:F,deps:[[new y,R]]},He={provide:h,useFactory:Ve,deps:[[new y,R],re]};function st(e,...t){return w("angularfire",Z.full,"fn"),M([He,Ge,{provide:R,useFactory:Be(e),multi:!0,deps:[V,j,te,oe,[new y,ae],[new y,ie],...t]}])}var Ne=ne(we,!0);var Te=class e{firestore=T(ce);auth=T(se);functions=T(h);async getAdmins(){let t=ue(this.firestore,"admins");return(await de(t)).docs.map(r=>_({uid:r.id},r.data()))}async getUidByEmail(t){let r=await Ne(this.functions,"getUidByEmail")({email:t}),o=r&&typeof r.data=="object"?r.data:{};if(!o.uid)throw new Error("No existe un usuario con ese email");return{uid:o.uid,email:o.email}}async addAdminByEmail(t){let{uid:n}=await this.getUidByEmail(t);await this.addAdminByUid(n,t)}async addAdminByUid(t,n){let r=b(this.firestore,"admins",t);await fe(r,{email:n})}async removeAdmin(t){let n=b(this.firestore,"admins",t);await le(n)}isCurrentUserAdmin(){return this.auth.currentUser?U(this.auth.currentUser.getIdToken()).pipe(L(()=>{let t=this.auth.currentUser?.uid;return t?N(b(this.firestore,"admins",t)).pipe(P(n=>n.id===t)):N(!1)})):N(!1)}static \u0275fac=function(n){return new(n||e)};static \u0275prov=x({token:e,factory:e.\u0275fac,providedIn:"root"})};export{je as a,st as b,Te as c};
