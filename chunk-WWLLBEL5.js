import{A as x,D as f,G as C,L as q,P as T,U as D,V as z,_ as k,aa as I,b as S,g as p,h as n,i as E,m as b,n as _,o as g,p as o,q as r,r as y,t as m,x as v}from"./chunk-CAKCF2Q7.js";var w=c=>["/prompt",c],A=(c,e)=>e.id;function N(c,e){if(c&1&&(o(0,"li",9)(1,"a",10),y(2,"pd-highlighted-text",11),r(),y(3,"pd-highlighted-text",12)(4,"pd-highlighted-text",13),r()),c&2){let t=e.$implicit;n(),g("routerLink",x(4,w,t.originalItem.slug)),n(),g("textData",t.titulo),n(),g("textData",t.prompt),n(),g("textData",t.descripcion)}}var L=class c{longitud=50;persistService=S(z);todasLasEtiquetas=this.persistService.tags();todasLasCategorias=this.persistService.categories();host=window.location.origin;basePath=S(C);baseUrl=p(this.host+this.basePath);etiquetas=p([]);categorias=p([]);currentSearchTerm=p("");fuzzySearchEnabled=p(!0);allSearchResults=p([]);prompts=f(()=>{let e=this.allSearchResults(),t=this.categorias(),i=this.etiquetas();return t.length===0&&i.length===0?e:e.filter(l=>{let s=l.originalItem.categoria,a=t.length===0||t.some(u=>s.includes(u)),d=l.originalItem.tags||[],h=i.length===0||i.some(u=>d.some(M=>M.includes(u)));return a||h})});etiquetasActuales=f(()=>this.todasLasEtiquetas.map(e=>({id:e.slug,name:e.text,activa:this.etiquetas().length!==this.todasLasEtiquetas.length&&this.etiquetas().includes(e.text)})).sort((e,t)=>(e.activa===!0?0:1)-(t.activa===!0?0:1)||e.name.localeCompare(t.name)));categoriasActuales=f(()=>this.todasLasCategorias.map(e=>({id:e.slug,name:e.text,activa:this.categorias().length!==this.todasLasCategorias.length&&this.categorias().includes(e.text)})).sort((e,t)=>(e.activa===!0?0:1)-(t.activa===!0?0:1)||e.name.localeCompare(t.name)));onSearch(e){this.currentSearchTerm.set(e);let t=this.persistService.search(e,this.fuzzySearchEnabled());if(t.found.length===0){this.etiquetas.set([]),this.categorias.set([]),this.allSearchResults.set([]);return}let i=t.found.map(a=>{let d={id:a.item.id,titulo:{parts:[],in:-1},prompt:{parts:[],in:-1},descripcion:{parts:[],in:-1},autor:{parts:[],in:-1},categoria:{parts:[],in:-1},tags:[],matchType:a.relevanceScore===1?"exact":"fuzzy",matchScore:a.relevanceScore,originalItem:a.item};if(e.length>0)if(a.foundIn!=="tags"){let h=D(a.item[a.foundIn],e,this.longitud);d[a.foundIn]={parts:h.parts,in:h.highlightIndex}}else d.tags=a.item.tags.filter(h=>t.etiquetas.some(u=>u.toLowerCase()===h.toLowerCase()));return this.fillEmptyFields(d,a.item),d}),l=new Set([...this.categorias(),...t.categorias]),s=new Set([...this.etiquetas(),...t.etiquetas]);this.etiquetas.set(Array.from(s)),this.categorias.set(Array.from(l)),this.allSearchResults.set(i),console.log("Resultados de b\xFAsqueda:",i)}onCategoriaToggle(e){let t=this.categorias();e.activa?this.categorias.set(t.filter(i=>i!==e.name)):this.categorias.set([...t,e.name])}onEtiquetaToggle(e){let t=this.etiquetas();e.activa?this.etiquetas.set(t.filter(i=>i!==e.name)):this.etiquetas.set([...t,e.name])}onFuzzyToggle(e){let t=e.target;this.fuzzySearchEnabled.set(t.checked),this.currentSearchTerm()&&this.onSearch(this.currentSearchTerm())}fillEmptyFields(e,t){e.titulo.parts.length===0&&(e.titulo={parts:[t.titulo.slice(0,this.longitud)],in:-1}),e.prompt.parts.length===0&&(e.prompt={parts:[t.prompt.slice(0,this.longitud)],in:-1}),e.descripcion.parts.length===0&&(e.descripcion={parts:[`${t.descripcion.slice(0,this.longitud)}...`],in:-1})}static \u0275fac=function(t){return new(t||c)};static \u0275cmp=E({type:c,selectors:[["pd-searching"]],decls:16,vars:3,consts:[["pd-search-header","",3,"search"],[1,"px-6","py-4","overflow-hidden"],[1,"mb-4","flex","items-center","gap-3"],[1,"flex","items-center","gap-2","text-sm","text-gray-600","dark:text-gray-300"],["type","checkbox",1,"rounded","border-gray-300",3,"change","checked"],[1,"py-2"],[3,"chipClicked","items"],[1,"py-6","w-full"],[1,"divide-y-[0.5px]","divide-gray-500","space-y-2","overflow-hidden"],[1,"flex","flex-col","pt-1","pb-3","items-start","justify-center","relative"],[3,"routerLink"],[1,"text-primary-dark","uppercase","font-semibold","opacity-85","text-sm","group-hover:opacity-100","truncate","w-full",3,"textData"],[1,"font-merri","italic",3,"textData"],[3,"textData"]],template:function(t,i){t&1&&(o(0,"header",0),m("search",function(s){return i.onSearch(s)}),r(),o(1,"div",1)(2,"div",2)(3,"label",3)(4,"input",4),m("change",function(s){return i.onFuzzyToggle(s)}),r(),v(5," B\xFAsqueda inteligente (tolerante a errores) "),r()(),o(6,"h4",5),v(7,"Categor\xEDas"),r(),o(8,"pd-chips-list",6),m("chipClicked",function(s){return i.onCategoriaToggle(s)}),r(),o(9,"h4",5),v(10,"Etiquetas"),r(),o(11,"pd-chips-list",6),m("chipClicked",function(s){return i.onEtiquetaToggle(s)}),r(),o(12,"div",7)(13,"ul",8),b(14,N,5,6,"li",9,A),r()()()),t&2&&(n(4),g("checked",i.fuzzySearchEnabled()),n(4),g("items",i.categoriasActuales()),n(3),g("items",i.etiquetasActuales()),n(3),_(i.prompts()))},dependencies:[k,T,I,q],encapsulation:2})};export{L as Searching};
