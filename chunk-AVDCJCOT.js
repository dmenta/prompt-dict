import{a as q,b as ge,d as fe,e as ve}from"./chunk-LFCSFENE.js";import{A as M,B as k,C as s,Ca as j,D as p,E as l,F as y,G as g,H as u,I as w,J as Q,K as f,L as W,M as d,N as $,P as c,Q as I,R as z,Ra as S,Sa as re,T as X,Ta as ne,U as Y,V as Z,X as E,ba as ee,c as G,d as J,f as m,fa as L,fb as ae,ga as A,gb as oe,h as v,hb as le,i as h,ia as N,ib as pe,ja as te,jb as se,kb as me,l as x,lb as de,mb as ce,n as a,na as H,o as R,oa as ie,p as _,sb as ue,w as P,x as K,y as D}from"./chunk-HIGNFRHE.js";var Te=(r,t)=>t.name;function Me(r,t){if(r&1&&(g(0,"div",10)(1,"span"),c(2),u(),g(3,"div",14)(4,"span",15),c(5),u(),g(6,"span",16),c(7),u()()()),r&2){let e=t.$implicit;a(2),I(e.name),a(3),z("",e.count," prompts"),a(2),z("(",e.percentage,"%)")}}function ke(r,t){if(r&1&&(g(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6),c(4),u(),g(5,"div",7),c(6,"Total"),u()(),g(7,"div",5)(8,"div",6),c(9),u(),g(10,"div",7),c(11,"Promedio"),u()(),g(12,"div",5)(13,"div",6),c(14),u(),g(15,"div",7),c(16,"Mediana"),u()(),g(17,"div",5)(18,"div",6),c(19),u(),g(20,"div",7),c(21,"Percentil 75"),u()()(),g(22,"div")(23,"h3",8),c(24,"\u{1F4CA} Distribuci\xF3n por Rangos"),u(),g(25,"div",9),M(26,Me,8,3,"div",10,Te),u()(),g(28,"div",11)(29,"h3",12),c(30," \u{1F4A1} Recomendaci\xF3n para Edici\xF3n Inline "),u(),g(31,"p",13),c(32),u()()()),r&2){let e=t,i=d();a(4),I(e.total),a(5),I(e.avg),a(5),I(e.median),a(5),I(e.p75),a(7),k(e.ranges),a(6),z(" ",i.getRecommendation(e)," ")}}var O=class r{appData=m(S);loading=x(!1);stats=x(null);async analyzePrompts(){this.loading.set(!0);try{let t=this.appData.prompts();if(t.length===0){alert("No hay prompts para analizar");return}let e=t.map(C=>C.prompt?.length||0).filter(C=>C>0).sort((C,T)=>C-T),i=e.length,n=Math.min(...e),o=Math.max(...e),b=Math.round(e.reduce((C,T)=>C+T,0)/i),U=e[Math.floor(i/2)],Se=e[Math.floor(i*.25)],Ee=e[Math.floor(i*.75)],Pe=e[Math.floor(i*.9)],De=[{name:"Muy cortos (< 100)",min:0,max:99},{name:"Cortos (100-300)",min:100,max:300},{name:"Medianos (301-600)",min:301,max:600},{name:"Largos (601-1000)",min:601,max:1e3},{name:"Muy largos (> 1000)",min:1001,max:1/0}].map(C=>{let T=e.filter(B=>B>=C.min&&B<=C.max).length,we=Math.round(T/i*100);return{name:C.name,count:T,percentage:we}});this.stats.set({total:i,min:n,max:o,avg:b,median:U,p25:Se,p75:Ee,p90:Pe,ranges:De})}finally{this.loading.set(!1)}}getRecommendation(t){return t.p75<=300?`El 75% de tus prompts tienen \u2264 ${t.p75} caracteres. Recomendaci\xF3n: L\xEDmite para edici\xF3n inline = 300 caracteres.`:t.median<=300?`El 50% de tus prompts tienen \u2264 ${t.median} caracteres. Recomendaci\xF3n: L\xEDmite para edici\xF3n inline = 400 caracteres.`:`La mayor\xEDa de tus prompts son largos (mediana: ${t.median} caracteres). Recomendaci\xF3n: L\xEDmite para edici\xF3n inline = 200 caracteres (solo cambios r\xE1pidos).`}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=_({type:r,selectors:[["pd-prompt-analyzer"]],decls:6,vars:3,consts:[[1,"p-6","bg-white","dark:bg-gray-800","rounded-lg","shadow-lg"],[1,"text-2xl","font-bold","mb-4"],[1,"mb-6","px-4","py-2","bg-blue-500","text-white","rounded","hover:bg-blue-600","disabled:opacity-50",3,"click","disabled"],[1,"space-y-6"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4"],[1,"text-center","p-3","bg-gray-100","dark:bg-gray-700","rounded"],[1,"text-2xl","font-bold"],[1,"text-sm","text-gray-600","dark:text-gray-300"],[1,"text-lg","font-semibold","mb-3"],[1,"space-y-2"],[1,"flex","items-center","justify-between","p-2","bg-gray-50","dark:bg-gray-700","rounded"],[1,"p-4","bg-blue-50","dark:bg-blue-900/20","border-l-4","border-blue-400","rounded"],[1,"text-lg","font-semibold","text-blue-800","dark:text-blue-200","mb-2"],[1,"text-blue-700","dark:text-blue-300"],[1,"flex","items-center","space-x-2"],[1,"font-medium"],[1,"text-sm","text-gray-500"]],template:function(e,i){if(e&1&&(g(0,"div",0)(1,"h2",1),c(2,"\u{1F4CA} An\xE1lisis de Longitud de Prompts"),u(),g(3,"button",2),W("click",function(){return i.analyzePrompts()}),c(4),u(),P(5,ke,33,5,"div",3),u()),e&2){let n;a(3),Q("disabled",i.loading()),a(),z(" ",i.loading()?"\u23F3 Analizando...":"\u{1F50D} Analizar Prompts"," "),a(),D((n=i.stats())?5:-1,n)}},encapsulation:2})};var he=class r{static \u0275fac=function(e){return new(e||r)};static \u0275cmp=_({type:r,selectors:[["pd-admin-page"]],decls:3,vars:0,consts:[[1,"space-y-8","p-6"]],template:function(e,i){e&1&&(p(0,"div",0),y(1,"pd-admin-management")(2,"pd-prompt-analyzer"),l())},dependencies:[ve,O],encapsulation:2})};var _e=class r{enabled=x(!1);submitting=x(!1);static \u0275fac=function(e){return new(e||r)};static \u0275cmp=_({type:r,selectors:[["pd-create-prompt-page"]],decls:3,vars:2,consts:[["form",""],["titulo","Nuevo Prompt",3,"apply","enabled","waiting"],[3,"valid","submiting"]],template:function(e,i){if(e&1){let n=w();p(0,"pd-task-header",1),f("apply",function(b){v(n);let U=$(2);return h(U.onSubmit(b))}),l(),p(1,"pd-create-prompt-form",2,0),f("valid",function(b){return v(n),h(i.enabled.set(b))})("submiting",function(b){return v(n),h(i.submitting.set(b))}),l()}e&2&&s("enabled",i.enabled())("waiting",i.submitting())},dependencies:[me,ge],encapsulation:2})};function Ie(r,t){if(r&1&&(p(0,"div",3),y(1,"ul",5),l()),r&2){let e=d();a(),s("prompts",e.persistService.prompts())}}function Ae(r,t){r&1&&(p(0,"div",4)(1,"span",6)(2,"span",7),y(3,"span",8)(4,"span",9),l()(),p(5,"span",10),c(6,"cargando"),l(),p(7,"span",10),c(8,"prompts"),l()())}var ye=class r{persistService=m(S);static \u0275fac=function(e){return new(e||r)};static \u0275cmp=_({type:r,selectors:[["pd-home"]],hostAttrs:[1,"w-full"],decls:6,vars:1,consts:[["drawer",""],["pd-main-header","",3,"open"],["pd-drawer","",1,"w-fit","select-none"],[1,"flex","flex-row","md:ml-72"],[1,"flex","flex-col","md:ml-72","items-center","justify-center","h-[80svh]"],["pd-prompts-list","",1,"px-6","py-6",3,"prompts"],[1,"relative","inline-flex","mb-2"],[1,"flex","size-5"],[1,"absolute","inline-flex","h-full","w-full","animate-ping","rounded-full","bg-primary","opacity-75"],[1,"relative","inline-flex","size-5","rounded-full","bg-primary-light"],[1,"opacity-95"]],template:function(e,i){if(e&1){let n=w();p(0,"header",1),f("open",function(){v(n);let b=$(2);return h(b.show())}),l(),p(1,"div",2,0),y(3,"pd-nav-menu"),l(),P(4,Ie,2,1,"div",3)(5,Ae,9,0,"div",4)}e&2&&(a(4),D(i.persistService.prompts().length>0?4:5))},dependencies:[q,le,ne,fe],encapsulation:2})};var Fe=(r,t)=>t.key;function Ve(r,t){if(r&1){let e=w();p(0,"ul",2)(1,"li",3),f("valueChange",function(n){v(e);let o=d(2);return h(o.updateField("titulo",n))}),l(),p(2,"li",4),f("valueChange",function(n){v(e);let o=d(2);return h(o.updateField("prompt",n))}),l(),p(3,"li",5),f("valueChange",function(n){v(e);let o=d(2);return h(o.updateField("descripcion",n))}),l(),p(4,"li",6),f("valueChange",function(n){v(e);let o=d(2);return h(o.updateField("categoria",n))}),l(),p(5,"li",7),f("valueChange",function(n){v(e);let o=d(2);return h(o.updateTags(n))}),l(),y(6,"li",8)(7,"li",9)(8,"li",10),l()}if(r&2){let e=d(),i=d();a(),s("value",e.titulo),a(),s("value",e.prompt)("fieldType",i.getFieldType("prompt"))("maxLength",400),a(),s("value",e.descripcion),a(),s("value",e.categoria)("selectOptions",i.availableCategories()),a(),s("value",e.tags),a(),s("value",e.autor),a(),s("value",e.fecha_creacion),a(),s("value",e.id)}}function ze(r,t){if(r&1&&y(0,"li",11),r&2){let e=t.$implicit,i=d(2);s("label",e.label)("value",i[e.key])}}function Re(r,t){if(r&1&&(p(0,"ul",2),M(1,ze,1,2,"li",11,Fe),l()),r&2){let e=d(2);a(),k(e.displayProperties)}}function $e(r,t){if(r&1){let e=w();p(0,"header",0),f("delete",function(n){v(e);let o=d();return h(o.onDelete(n))})("copyPrompt",function(n){v(e);let o=d();return h(o.onCopyPrompt(n))})("share",function(n){v(e);let o=d();return h(o.onShare(n))}),l(),p(1,"div",1),P(2,Ve,9,11,"ul",2),Y(3,"async"),K(4,Re,3,0,"ul",2),l()}if(r&2){let e=d();s("titulo",t.titulo),a(2),D(Z(3,2,e.isAdmin$)?2:4)}}var be=class r{notificationService=m(H);persistService=m(S);adminService=m(re);url=x(window.location.href);route=m(A);router=m(N);data=j(this.route.data);copyService=m(ie);prompt=E(()=>{let t=this.data()?.prompt;return t?.id&&this.persistService.prompts().find(i=>i.id===t.id)||t});isAdmin$=this.adminService.isCurrentUserAdmin();availableCategories=E(()=>this.persistService.categories().map(t=>t.name));displayProperties=[{label:"T\xEDtulo",key:"titulo"},{label:"Texto",key:"prompt"},{label:"Descripci\xF3n",key:"descripcion"},{label:"Autor",key:"autor"},{label:"Categor\xEDa",key:"categoria"},{label:"Creado",key:"fecha_creacion"},{label:"Etiquetas",key:"tags"},{label:"ID",key:"id"}];constructor(t){let e=this.prompt();e&&t.setTitle(`${e.titulo} | Prompter`)}onDelete(t){t.stopPropagation();let e=this.prompt();e?.id&&(this.persistService.deletePrompt(e.id),this.notificationService.success("Prompt eliminado"),this.router.navigate(["/"]))}onCopyPrompt(t){t.stopPropagation();let e=this.prompt();e?.prompt&&this.copyService.copy(e.prompt)}async onShare(t){if(t.stopPropagation(),!navigator.canShare){this.copyService.copy(this.url());return}let e=this.prompt(),i=this.url(),n={title:"Prompter",text:e.titulo,url:i};if(navigator.canShare(n))try{await navigator.share(n)}catch(o){console.warn("Error al compartir el prompt:",o)}else this.copyService.copy(this.url())}async updateField(t,e){try{let i=this.prompt();if(!i?.id)return;let n=i.id,o={[t]:e};await this.persistService.updatePrompt(n,o),this.notificationService.success(`${t} actualizado`)}catch(i){this.notificationService.error(`Error al actualizar ${t}`),console.error("Error updating field:",i)}}async updateTags(t){try{let e=t.split(",").map(i=>i.trim()).filter(i=>i.length>0);await this.updateField("tags",e)}catch(e){this.notificationService.error("Error al actualizar etiquetas"),console.error("Error updating tags:",e)}}getFieldType(t){let i=this.prompt()?.prompt?.length||0;return t==="prompt"?i<=400?"textarea":"text":t==="descripcion"?"textarea":t==="categoria"?"select":"text"}static \u0275fac=function(e){return new(e||r)(R(L))};static \u0275cmp=_({type:r,selectors:[["pd-prompt-detail"]],hostAttrs:[1,"w-full"],decls:1,vars:1,consts:[["pd-detail-header","",3,"delete","copyPrompt","share","titulo"],[1,"px-6","py-6","w-full"],[1,"divide-y-[0.5px]","divide-gray-500/50","space-y-2"],["pd-editable-field","","label","T\xEDtulo","fieldType","text",3,"valueChange","value"],["pd-editable-field","","label","Texto del Prompt",3,"valueChange","value","fieldType","maxLength"],["pd-editable-field","","label","Descripci\xF3n","fieldType","textarea",3,"valueChange","value"],["pd-editable-field","","label","Categor\xEDa","fieldType","select",3,"valueChange","value","selectOptions"],["pd-editable-field","","label","Etiquetas","fieldType","text",3,"valueChange","value"],["pd-key-value-item","","label","Autor",3,"value"],["pd-key-value-item","","label","Creado",3,"value"],["pd-key-value-item","","label","ID",3,"value"],["pd-key-value-item","",3,"label","value"]],template:function(e,i){if(e&1&&P(0,$e,5,4),e&2){let n;D((n=i.prompt())?0:-1,n)}},dependencies:[oe,ce,ae,ee],encapsulation:2})};var xe=class r{notificationService=m(H);router=m(N);route=m(A);persist=m(S);data=j(this.route.data);prompts=E(()=>this.data().item.prompts);titulo=E(()=>this.data().item.name);subtitulo=E(()=>this.resolvedSubtitulo(this.prompts().length,this.data().type.lowercase));borrable=E(()=>this.prompts().length<=0);constructor(t){t.setTitle(`${this.data()?.item.name} | ${this.data()?.type.title} | Prompter`)}async onDelete(t){t.stopPropagation(),this.borrable()&&(this.data()?.type.lowercase==="etiqueta"?this.persist.deleteTag(this.data()?.item.name).then(()=>{this.notificationService.success("Etiqueta eliminada."),this.router.navigate(["/"])}):this.persist.deleteCategory(this.data()?.item.name).then(()=>{this.notificationService.success("Categor\xEDa eliminada."),this.router.navigate(["/"])}))}resolvedSubtitulo(t,e){return`${t===0?"Ning\xFAn prompt asociado":t===1?"1 prompt asociado":`${t.toFixed(0)} prompts asociados`} a esta ${e}`}static \u0275fac=function(e){return new(e||r)(R(L))};static \u0275cmp=_({type:r,selectors:[["pd-prompts"]],hostAttrs:[1,"w-full"],decls:3,vars:4,consts:[["pd-section-header","",3,"delete","titulo","subtitulo","enabled"],[1,"flex","flex-row","w-full"],["pd-prompts-list","",1,"p-4",3,"prompts"]],template:function(e,i){e&1&&(p(0,"header",0),f("delete",function(o){return i.onDelete(o)}),l(),p(1,"div",1),y(2,"ul",2),l()),e&2&&(s("titulo",i.titulo())("subtitulo",i.subtitulo())("enabled",i.borrable()),a(2),s("prompts",i.prompts()))},dependencies:[q,se],encapsulation:2})};var Le=(r,t)=>["/",r,t],He=(r,t)=>t.id;function je(r,t){if(r&1&&(p(0,"li",2)(1,"a",3),y(2,"pd-highlighted-text",4)(3,"pd-highlighted-text",5)(4,"pd-highlighted-text",6),l()()),r&2){let e=t.$implicit,i=d();a(),s("routerLink",X(4,Le,i.promptUrl,e.originalItem.slug)),a(),s("textData",e.titulo),a(),s("textData",e.prompt),a(),s("textData",e.descripcion)}}var Ce=class r{longitud=50;route=m(A);router=m(N);persistService=m(S);emptySearch=[];currentSearchTerm=x("");promptUrl="prompt";allSearchResults=x([]);initSearch=x("");ngOnInit(){this.route.queryParams.pipe(J(t=>t.search),G(t=>t.search)).subscribe(t=>{this.initSearch.set(t)})}onSearch(t){if(this.router.navigate([],{relativeTo:this.route,queryParams:{search:t.trim()},queryParamsHandling:"merge"}),t.length===0){this.allSearchResults.set(this.emptySearch),this.currentSearchTerm.set("");return}this.currentSearchTerm.set(t);let e=this.persistService.search(t);if(e.found.length===0){this.allSearchResults.set([]);return}let i=e.found.map(n=>{let o={id:n.item.id,titulo:{parts:[],in:-1},prompt:{parts:[],in:-1},descripcion:{parts:[],in:-1},autor:{parts:[],in:-1},matchType:n.relevanceScore===1?"exact":"fuzzy",matchScore:n.relevanceScore,originalItem:n.item};if(t.length>0&&n.foundIn!=="tags"&&n.foundIn!=="categoria"){let b=ue(n.item[n.foundIn],t,this.longitud);o[n.foundIn]={parts:b.parts,in:b.highlightIndex}}return this.fillEmptyFields(o,n.item),o});this.allSearchResults.set(i)}fillEmptyFields(t,e){t.titulo.parts.length===0&&(t.titulo={parts:[e.titulo.slice(0,this.longitud)],in:-1}),t.prompt.parts.length===0&&(t.prompt={parts:[e.prompt.slice(0,this.longitud)],in:-1}),t.descripcion.parts.length===0&&(t.descripcion={parts:[`${e.descripcion.slice(0,this.longitud)}...`],in:-1})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=_({type:r,selectors:[["pd-searching"]],decls:4,vars:1,consts:[["pd-search-header","",3,"search","term"],[1,"divide-y-[0.5px]","divide-gray-500/50","px-6","py-4"],[1,"overflow-x-hidden","py-2","w-full","group"],[1,"opacity-90","group-hover:opacity-100","transition-opacity",3,"routerLink"],[1,"text-primary-dark","font-titulo","text-sm/5",3,"textData"],[1,"font-merri","italic",3,"textData"],[1,"text-sm/5",3,"textData"]],template:function(e,i){e&1&&(p(0,"header",0),f("search",function(o){return i.onSearch(o)}),l(),p(1,"ul",1),M(2,je,5,7,"li",2,He),l()),e&2&&(s("term",i.initSearch()),a(2),k(i.allSearchResults()))},dependencies:[pe,de,te],encapsulation:2})};export{he as AdminPage,_e as CreatePromptPage,ye as Home,be as PromptDetail,xe as Prompts,Ce as Searching};
