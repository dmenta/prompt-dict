import{h as T,j as P,q as C}from"./chunk-F3CF62S6.js";import{c as b,e as D,f as _,l as R}from"./chunk-6BDU6Y2Z.js";import"./chunk-YORCQQOF.js";import{R as o,Ua as f,Va as y,Wa as s,Xa as c,Ya as l,Za as v,ca as p,cb as x,eb as E,p as u,qa as n,tb as I,w as g,ya as S}from"./chunk-GMSQNKQY.js";var F=(r,t)=>["/",r,t],M=(r,t)=>t.id;function N(r,t){if(r&1&&(c(0,"li",2)(1,"a",3),v(2,"pd-highlighted-text",4)(3,"pd-highlighted-text",5)(4,"pd-highlighted-text",6),l()()),r&2){let e=t.$implicit,a=E();n(),s("routerLink",I(4,F,a.promptUrl,e.originalItem.slug)),n(),s("textData",e.titulo),n(),s("textData",e.prompt),n(),s("textData",e.descripcion)}}var k=class r{longitud=50;route=o(b);router=o(D);persistService=o(R);emptySearch=[];currentSearchTerm=p("");promptUrl="prompt";allSearchResults=p([]);initSearch=p("");ngOnInit(){this.route.queryParams.pipe(g(t=>t.search),u(t=>t.search)).subscribe(t=>{this.initSearch.set(t)})}onSearch(t){if(this.router.navigate([],{relativeTo:this.route,queryParams:{search:t.trim()},queryParamsHandling:"merge"}),t.length===0){this.allSearchResults.set(this.emptySearch),this.currentSearchTerm.set("");return}this.currentSearchTerm.set(t),this.persistService.search(t,!0).then(a=>{if(a.found.length===0){this.allSearchResults.set([]);return}let d=a.found.map(i=>{let h={id:i.item.id,titulo:{parts:[],in:-1},prompt:{parts:[],in:-1},descripcion:{parts:[],in:-1},autor:{parts:[],in:-1},matchType:i.relevanceScore===1?"exact":"fuzzy",matchScore:i.relevanceScore,originalItem:i.item};if(t.length>0&&i.foundIn!=="tags"&&i.foundIn!=="categoria"){let m=C(i.item[i.foundIn],t,this.longitud);h[i.foundIn]={parts:m.parts,in:m.highlightIndex}}return this.fillEmptyFields(h,i.item),h});this.allSearchResults.set(d)})}fillEmptyFields(t,e){t.titulo.parts.length===0&&(t.titulo={parts:[e.titulo.slice(0,this.longitud)],in:-1}),t.prompt.parts.length===0&&(t.prompt={parts:[e.prompt.slice(0,this.longitud)],in:-1}),t.descripcion.parts.length===0&&(t.descripcion={parts:[`${e.descripcion.slice(0,this.longitud)}...`],in:-1})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=S({type:r,selectors:[["pd-searching"]],decls:4,vars:1,consts:[["pd-search-header","",3,"search","term"],[1,"divide-y-[0.5px]","divide-gray-500/50","px-6","py-4"],[1,"overflow-x-hidden","py-2","w-full","group"],[1,"opacity-90","group-hover:opacity-100","transition-opacity",3,"routerLink"],[1,"text-primary-dark","font-titulo","text-sm/5",3,"textData"],[1,"font-merri","italic",3,"textData"],[1,"text-sm/5",3,"textData"]],template:function(e,a){e&1&&(c(0,"header",0),x("search",function(i){return a.onSearch(i)}),l(),c(1,"ul",1),f(2,N,5,7,"li",2,M),l()),e&2&&(s("term",a.initSearch()),n(2),y(a.allSearchResults()))},dependencies:[T,P,_],encapsulation:2})};export{k as Searching};
