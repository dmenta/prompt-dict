import{$ as k,A as b,C as v,K as q,O as C,T,U as z,Z as D,b as S,g as p,h as n,i as y,m as E,n as x,o as l,p as o,q as a,r as f,t as g,u as _,x as m}from"./chunk-4GII6ZTD.js";var A=(c,e)=>["/",c,e],M=(c,e)=>e.id;function N(c,e){if(c&1&&(o(0,"li",9)(1,"a",10),f(2,"pd-highlighted-text",11),a(),f(3,"pd-highlighted-text",12)(4,"pd-highlighted-text",13),a()),c&2){let t=e.$implicit,i=_();n(),l("routerLink",b(4,A,i.promptUrl,t.originalItem.slug)),n(),l("textData",t.titulo),n(),l("textData",t.prompt),n(),l("textData",t.descripcion)}}var I=class c{longitud=50;promptUrl="prompt";persistService=S(z);todasLasEtiquetas=this.persistService.tags();todasLasCategorias=this.persistService.categories();etiquetas=p([]);categorias=p([]);currentSearchTerm=p("");fuzzySearchEnabled=p(!0);allSearchResults=p([]);prompts=v(()=>{let e=this.allSearchResults(),t=this.categorias(),i=this.etiquetas();return e});etiquetasActuales=v(()=>this.todasLasEtiquetas.map(e=>({id:e.slug,name:e.text,activa:this.etiquetas().length!==this.todasLasEtiquetas.length&&this.etiquetas().includes(e.text)})).sort((e,t)=>(e.activa===!0?0:1)-(t.activa===!0?0:1)||e.name.localeCompare(t.name)));categoriasActuales=v(()=>this.todasLasCategorias.map(e=>({id:e.slug,name:e.text,activa:this.categorias().length!==this.todasLasCategorias.length&&this.categorias().includes(e.text)})).sort((e,t)=>(e.activa===!0?0:1)-(t.activa===!0?0:1)||e.name.localeCompare(t.name)));onSearch(e){this.currentSearchTerm.set(e);let t=this.persistService.search(e,this.fuzzySearchEnabled());if(t.found.length===0){this.etiquetas.set([]),this.categorias.set([]),this.allSearchResults.set([]);return}let i=t.found.map(r=>{let h={id:r.item.id,titulo:{parts:[],in:-1},prompt:{parts:[],in:-1},descripcion:{parts:[],in:-1},autor:{parts:[],in:-1},categoria:{parts:[],in:-1},tags:[],matchType:r.relevanceScore===1?"exact":"fuzzy",matchScore:r.relevanceScore,originalItem:r.item};if(e.length>0)if(r.foundIn!=="tags"){let u=T(r.item[r.foundIn],e,this.longitud);h[r.foundIn]={parts:u.parts,in:u.highlightIndex}}else h.tags=r.item.tags.filter(u=>t.etiquetas.some(L=>L.toLowerCase()===u.toLowerCase()));return this.fillEmptyFields(h,r.item),h}),d=new Set([...this.categorias(),...t.categorias]),s=new Set([...this.etiquetas(),...t.etiquetas]);this.etiquetas.set(Array.from(s)),this.categorias.set(Array.from(d)),this.allSearchResults.set(i),console.log("Resultados de b\xFAsqueda:",i)}onCategoriaToggle(e){let t=this.categorias();e.activa?this.categorias.set(t.filter(i=>i!==e.name)):this.categorias.set([...t,e.name])}onEtiquetaToggle(e){let t=this.etiquetas();e.activa?this.etiquetas.set(t.filter(i=>i!==e.name)):this.etiquetas.set([...t,e.name])}onFuzzyToggle(e){let t=e.target;this.fuzzySearchEnabled.set(t.checked),this.currentSearchTerm()&&this.onSearch(this.currentSearchTerm())}fillEmptyFields(e,t){e.titulo.parts.length===0&&(e.titulo={parts:[t.titulo.slice(0,this.longitud)],in:-1}),e.prompt.parts.length===0&&(e.prompt={parts:[t.prompt.slice(0,this.longitud)],in:-1}),e.descripcion.parts.length===0&&(e.descripcion={parts:[`${t.descripcion.slice(0,this.longitud)}...`],in:-1})}static \u0275fac=function(t){return new(t||c)};static \u0275cmp=y({type:c,selectors:[["pd-searching"]],decls:16,vars:3,consts:[["pd-search-header","",3,"search"],[1,"px-6","py-4","overflow-hidden"],[1,"mb-4","flex","items-center","gap-3"],[1,"flex","items-center","gap-2","text-sm","text-gray-600","dark:text-gray-300"],["type","checkbox",1,"rounded","border-gray-300",3,"change","checked"],[1,"py-2"],[3,"chipClicked","items"],[1,"py-6","w-full"],[1,"divide-y-[0.5px]","divide-gray-500","space-y-2","overflow-hidden"],[1,"flex","flex-col","pt-1","pb-3","items-start","justify-center","relative"],[3,"routerLink"],[1,"text-primary-dark","uppercase","font-semibold","opacity-85","text-sm","group-hover:opacity-100","truncate","w-full",3,"textData"],[1,"font-merri","italic",3,"textData"],[3,"textData"]],template:function(t,i){t&1&&(o(0,"header",0),g("search",function(s){return i.onSearch(s)}),a(),o(1,"div",1)(2,"div",2)(3,"label",3)(4,"input",4),g("change",function(s){return i.onFuzzyToggle(s)}),a(),m(5," B\xFAsqueda inteligente (tolerante a errores) "),a()(),o(6,"h4",5),m(7,"Categor\xEDas"),a(),o(8,"pd-chips-list",6),g("chipClicked",function(s){return i.onCategoriaToggle(s)}),a(),o(9,"h4",5),m(10,"Etiquetas"),a(),o(11,"pd-chips-list",6),g("chipClicked",function(s){return i.onEtiquetaToggle(s)}),a(),o(12,"div",7)(13,"ul",8),E(14,N,5,7,"li",9,M),a()()()),t&2&&(n(4),l("checked",i.fuzzySearchEnabled()),n(4),l("items",i.categoriasActuales()),n(3),l("items",i.etiquetasActuales()),n(3),x(i.prompts()))},dependencies:[D,C,k,q],encapsulation:2})};export{I as Searching};
