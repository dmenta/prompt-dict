import{a as G,b as L,c as W,d as Z,e as z}from"./chunk-OSANOIMX.js";import{a as V,c as A,d as J}from"./chunk-OTIURIRC.js";import{$ as q,A as H,B as u,F as N,J as I,K as E,L as h,M as m,N as d,O as g,P as a,Q as s,R as S,W as _,Y as f,aa as R,ba as j,ea as p,fa as C,ga as w,h as $,j as D,ja as y,o as M,oa as x,r as k,ra as P,s as B,u as v,wa as Q,y as c}from"./chunk-G3VICSN5.js";var X=["searchInput"],b=class i{searchInput;searchControl=new W("");search=x();ngAfterViewInit(){setTimeout(()=>{this.searchInput.nativeElement.focus()},20),this.searchControl.valueChanges.pipe(D(""),$(200)).subscribe(t=>{let e=t?.trim()?.toLowerCase()??"";this.search.emit(e)})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=u({type:i,selectors:[["pd-searcher"]],viewQuery:function(e,r){if(e&1&&q(X,5),e&2){let n;R(n=j())&&(r.searchInput=n.first)}},outputs:{search:"search"},decls:3,vars:1,consts:[["searchInput",""],[1,"w-full"],["tabindex","0","type","text","autofocus","","placeholder","Buscar prompts...","aria-label","Buscar prompts","aria-autocomplete","list","aria-haspopup","listbox","aria-controls","search-options","aria-activedescendant","search-option-active",1,"w-full","text-primary-contrast","p-1.5","ring-0","outline-0","border-b-[1px]","border-dotted","border-b-contrast",3,"formControl"]],template:function(e,r){e&1&&(a(0,"div",1),S(1,"input",2,0),s()),e&2&&(c(),g("formControl",r.searchControl))},dependencies:[z,G,L,Z],encapsulation:2})};var F=class i{constructor(t){this.router=t}search=x();onMainButtonClick(t){t.stopPropagation(),this.router.navigate(["/"])}static \u0275fac=function(e){return new(e||i)(H(Q))};static \u0275cmp=u({type:i,selectors:[["pd-search-header"],["","pd-search-header",""]],outputs:{search:"search"},features:[N([J])],decls:4,vars:0,consts:[[3,"mainButtonClicked"],["nav-button","","height","24px","viewBox","0 -960 960 960","width","24px","fill","currentColor"],["d","m313-440 224 224-57 56-320-320 320-320 57 56-224 224h487v80H313Z"],[3,"search"]],template:function(e,r){e&1&&(a(0,"pd-header",0),_("mainButtonClicked",function(o){return r.onMainButtonClick(o)}),k(),a(1,"svg",1),S(2,"path",2),s(),B(),a(3,"pd-searcher",3),_("search",function(o){return r.search.emit(o)}),s()())},dependencies:[A,b],encapsulation:2})};var T=i=>({"dark:bg-[#FFFF0060] bg-[#FFFF00]":i}),Y=(i,t)=>t.id;function ee(i,t){if(i&1&&(a(0,"li",7),p(1),s()),i&2){let e=t.$implicit;c(),w(" ",e," ")}}function te(i,t){if(i&1&&(a(0,"h4",5),p(1,"Etiquetas"),s(),a(2,"ul",6),m(3,ee,2,1,"li",7,h),s()),i&2){let e=f();c(3),d(e.etiquetas())}}function ie(i,t){if(i&1&&(a(0,"li",7),p(1),s()),i&2){let e=t.$implicit;c(),w(" ",e," ")}}function re(i,t){if(i&1&&(a(0,"h4",5),p(1,"Categor\xEDas"),s(),a(2,"ul",6),m(3,ie,2,1,"li",7,h),s()),i&2){let e=f();c(3),d(e.categorias())}}function ne(i,t){if(i&1&&(a(0,"span",9),p(1),s()),i&2){let e=t.$implicit,r=t.$index,n=f().$implicit;g("ngClass",y(2,T,r===n.titulo.in)),c(),C(e)}}function ae(i,t){if(i&1&&(a(0,"span",9),p(1),s()),i&2){let e=t.$implicit,r=t.$index,n=f().$implicit;g("ngClass",y(2,T,r===n.prompt.in)),c(),C(e)}}function se(i,t){if(i&1&&(a(0,"span",9),p(1),s()),i&2){let e=t.$implicit,r=t.$index,n=f().$implicit;g("ngClass",y(2,T,r===n.descripcion.in)),c(),C(e)}}function oe(i,t){if(i&1&&(a(0,"li",4)(1,"div",8),m(2,ne,2,4,"span",9,h),s(),a(4,"div",8),m(5,ae,2,4,"span",9,h),s(),a(7,"div",8),m(8,se,2,4,"span",9,h),s()()),i&2){let e=t.$implicit;c(2),d(e.titulo.parts),c(3),d(e.prompt.parts),c(3),d(e.descripcion.parts)}}var U=class i{longitud=40;mediaLongitud=this.longitud/2;persistService=M(V);prompts=v([]);etiquetas=v([]);categorias=v([]);onSearch(t){let e=this.persistService.search(t);if(e.found.length===0){this.etiquetas.set([]),this.categorias.set([]),this.prompts.set([]);return}let r=e.found.map(n=>{let o={id:n.item.id,titulo:{parts:[],in:-1},prompt:{parts:[],in:-1},descripcion:{parts:[],in:-1},autor:{parts:[],in:-1},categoria:{parts:[],in:-1},tags:[]};return t.length>0&&(n.foundIn!=="tags"?o[n.foundIn]=this.relevantSection(n.item[n.foundIn],n.position,t.length):o.tags=n.item.tags.filter(l=>e.etiquetas.includes(l.toLowerCase()))),o.prompt.parts.length===0&&(o.prompt={parts:[`${n.item.prompt.slice(0,this.longitud)}`],in:-1}),o.descripcion.parts.length===0&&(o.descripcion={parts:[`${n.item.descripcion.slice(0,this.longitud)}...`],in:-1}),o});this.etiquetas.set(e.etiquetas),this.categorias.set(e.categorias),this.prompts.set(r)}relevantSection(t,e,r){let n=e-this.mediaLongitud,o=e+r+this.mediaLongitud,l=t.slice(e,e+r);return e<=0?{parts:[l,t.slice(e+r,this.longitud)],in:0}:e+r>=t.length?{parts:[t.slice(-this.longitud,-r),l],in:1}:n<0?{parts:[t.slice(0,e),l,t.slice(e+r,this.longitud)],in:1}:o>t.length?{parts:[t.slice(Math.max(0,t.length-this.longitud),e),l,t.slice(e+r)],in:1}:{parts:[t.slice(n,e),l,t.slice(e+r,o)],in:1}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=u({type:i,selectors:[["pd-searching"]],decls:8,vars:2,consts:[["pd-search-header","",3,"search"],[1,"px-6","py-4"],[1,"py-6","w-full"],[1,"divide-y-[0.5px]","divide-gray-500","space-y-2"],[1,"flex","flex-col","pt-1","pb-3","items-start","justify-center"],[1,"py-2","font-medium"],[1,"flex","flex-row","gap-3","overflow-x-auto","pt-1","pb-6"],[1,"text-sm","px-3","py-1","whitespace-nowrap","rounded-lg","border-primary-dark","border-[1px]"],[1,"whitespace-nowrap","flex","flex-row","justify-start","items-center"],[1,"text-lg","whitespace-pre",3,"ngClass"]],template:function(e,r){e&1&&(a(0,"header",0),_("search",function(o){return r.onSearch(o)}),s(),a(1,"div",1),I(2,te,5,0),I(3,re,5,0),a(4,"div",2)(5,"ul",3),m(6,oe,10,0,"li",4,Y),s()()()),e&2&&(c(2),E(r.etiquetas().length>0?2:-1),c(),E(r.categorias().length>0?3:-1),c(3),d(r.prompts()))},dependencies:[F,P],encapsulation:2})};export{U as Searching};
