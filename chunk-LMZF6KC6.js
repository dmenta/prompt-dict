import{h as T,j as P,q as C}from"./chunk-S5YTX3FU.js";import{Fa as R,I as f,J as y,K as s,L as c,M as l,N as v,S as x,U as E,d as u,fa as I,g,l as o,p,s as n,sa as b,ua as D,v as S,va as _}from"./chunk-BQLZ7SSS.js";var F=(r,e)=>["/",r,e],M=(r,e)=>e.id;function N(r,e){if(r&1&&(c(0,"li",2)(1,"a",3),v(2,"pd-highlighted-text",4)(3,"pd-highlighted-text",5)(4,"pd-highlighted-text",6),l()()),r&2){let t=e.$implicit,a=E();n(),s("routerLink",I(4,F,a.promptUrl,t.originalItem.slug)),n(),s("textData",t.titulo),n(),s("textData",t.prompt),n(),s("textData",t.descripcion)}}var k=class r{longitud=50;route=o(b);router=o(D);persistService=o(R);emptySearch=[];currentSearchTerm=p("");promptUrl="prompt";allSearchResults=p([]);initSearch=p("");ngOnInit(){this.route.queryParams.pipe(g(e=>e.search),u(e=>e.search)).subscribe(e=>{this.initSearch.set(e)})}onSearch(e){if(this.router.navigate([],{relativeTo:this.route,queryParams:{search:e.trim()},queryParamsHandling:"merge"}),e.length===0){this.allSearchResults.set(this.emptySearch),this.currentSearchTerm.set("");return}this.currentSearchTerm.set(e),this.persistService.search(e,!0).then(a=>{if(a.found.length===0){this.allSearchResults.set([]);return}let d=a.found.map(i=>{let h={id:i.item.id,titulo:{parts:[],in:-1},prompt:{parts:[],in:-1},descripcion:{parts:[],in:-1},autor:{parts:[],in:-1},matchType:i.relevanceScore===1?"exact":"fuzzy",matchScore:i.relevanceScore,originalItem:i.item};if(e.length>0&&i.foundIn!=="tags"&&i.foundIn!=="categoria"){let m=C(i.item[i.foundIn],e,this.longitud);h[i.foundIn]={parts:m.parts,in:m.highlightIndex}}return this.fillEmptyFields(h,i.item),h});this.allSearchResults.set(d)})}fillEmptyFields(e,t){e.titulo.parts.length===0&&(e.titulo={parts:[t.titulo.slice(0,this.longitud)],in:-1}),e.prompt.parts.length===0&&(e.prompt={parts:[t.prompt.slice(0,this.longitud)],in:-1}),e.descripcion.parts.length===0&&(e.descripcion={parts:[`${t.descripcion.slice(0,this.longitud)}...`],in:-1})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=S({type:r,selectors:[["pd-searching"]],decls:4,vars:1,consts:[["pd-search-header","",3,"search","term"],[1,"divide-y-[0.5px]","divide-gray-500/50","px-6","py-4"],[1,"overflow-x-hidden","py-2","w-full","group"],[1,"opacity-90","group-hover:opacity-100","transition-opacity",3,"routerLink"],[1,"text-primary-dark","uppercase","font-semibold","text-sm/5",3,"textData"],[1,"font-merri","italic",3,"textData"],[1,"text-sm/5",3,"textData"]],template:function(t,a){t&1&&(c(0,"header",0),x("search",function(i){return a.onSearch(i)}),l(),c(1,"ul",1),f(2,N,5,7,"li",2,M),l()),t&2&&(s("term",a.initSearch()),n(2),y(a.allSearchResults()))},dependencies:[T,P,_],encapsulation:2})};export{k as Searching};
